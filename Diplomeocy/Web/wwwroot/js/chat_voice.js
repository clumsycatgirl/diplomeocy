/*! For license information please see chat_voice.js.LICENSE.txt */
(()=>{var e={412:(e,t,o)=>{"use strict";var n,i;function r(e,t){if(!e)throw"First parameter is required.";t=new s(e,t=t||{type:"video"});var o=this;function n(o){o&&(t.initCallback=function(){o(),o=t.initCallback=null});var n=new a(e,t);(u=new n(e,t)).record(),h("recording"),t.disableLogs||console.log("Initialized recorderType:",u.constructor.name,"for output-type:",t.type)}function i(e){if(e=e||function(){},u){if("paused"===o.state)return o.resumeRecording(),void setTimeout((function(){i(e)}),1);"recording"===o.state||t.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',o.state),t.disableLogs||console.log("Stopped recording "+t.type+" stream."),"gif"!==t.type?u.stop(n):(u.stop(),n()),h("stopped")}else p();function n(n){if(u){Object.keys(u).forEach((function(e){"function"!=typeof u[e]&&(o[e]=u[e])}));var i=u.blob;if(!i){if(!n)throw"Recording failed.";u.blob=i=n}if(i&&!t.disableLogs&&console.log(i.type,"->",_(i.size)),e){var r;try{r=g.createObjectURL(i)}catch(e){}"function"==typeof e.call?e.call(o,r):e(r)}t.autoWriteToDisk&&d((function(e){var o={};o[t.type+"Blob"]=e,L.Store(o)}))}else"function"==typeof e.call?e.call(o,""):e("")}}function c(e){postMessage((new FileReaderSync).readAsDataURL(e))}function d(e,o){if(!e)throw"Pass a callback function over getDataURL.";var n=o?o.blob:(u||{}).blob;if(!n)return t.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout((function(){d(e,o)}),1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var i=new FileReader;i.readAsDataURL(n),i.onload=function(t){e(t.target.result)}}else{var r=function(e){try{var t=g.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(t);return g.revokeObjectURL(t),o}catch(e){}}(c);r.onmessage=function(t){e(t.data)},r.postMessage(n)}}function l(e){e=e||0,"paused"!==o.state?"stopped"!==o.state&&(e>=o.recordingDuration?i(o.onRecordingStopped):(e+=1e3,setTimeout((function(){l(e)}),1e3))):setTimeout((function(){l(e)}),1e3)}function h(e){o&&(o.state=e,"function"==typeof o.onStateChanged.call?o.onStateChanged.call(o,e):o.onStateChanged(e))}var u,f='It seems that recorder is destroyed or "startRecording" is not invoked for '+t.type+" recorder.";function p(){!0!==t.disableLogs&&console.warn(f)}var m={startRecording:function(i){return t.disableLogs||console.log("RecordRTC version: ",o.version),i&&(t=new s(e,i)),t.disableLogs||console.log("started recording "+t.type+" stream."),u?(u.clearRecordedData(),u.record(),h("recording"),o.recordingDuration&&l(),o):(n((function(){o.recordingDuration&&l()})),o)},stopRecording:i,pauseRecording:function(){u?"recording"===o.state?(h("paused"),u.pause(),t.disableLogs||console.log("Paused recording.")):t.disableLogs||console.warn("Unable to pause the recording. Recording state: ",o.state):p()},resumeRecording:function(){u?"paused"===o.state?(h("recording"),u.resume(),t.disableLogs||console.log("Resumed recording.")):t.disableLogs||console.warn("Unable to resume the recording. Recording state: ",o.state):p()},initRecorder:n,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return o.recordingDuration=e,o.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){o.onRecordingStopped=e}}},clearRecordedData:function(){u?(u.clearRecordedData(),t.disableLogs||console.log("Cleared old recorded data.")):p()},getBlob:function(){if(u)return u.blob;p()},getDataURL:d,toURL:function(){if(u)return g.createObjectURL(u.blob);p()},getInternalRecorder:function(){return u},save:function(e){u?y(u.blob,e):p()},getFromDisk:function(e){u?r.getFromDisk(t.type,e):p()},setAdvertisementArray:function(e){t.advertisement=[];for(var o=e.length,n=0;n<o;n++)t.advertisement.push({duration:n,image:e[n]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==o.state||t.disableLogs||console.warn("Stop an active recorder."),u&&"function"==typeof u.clearRecordedData&&u.clearRecordedData(),u=null,h("inactive"),o.blob=null},onStateChanged:function(e){t.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return o.state},destroy:function(){var e=t.disableLogs;t={disableLogs:!0},o.reset(),h("destroyed"),m=o=null,k.AudioContextConstructor&&(k.AudioContextConstructor.close(),k.AudioContextConstructor=null),t.disableLogs=e,t.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return o=m,m;for(var v in m)this[v]=m[v];return o=this,m}function s(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===M||t.recorderType===D||void 0!==B&&t.recorderType===B?t.type="video":t.recorderType===A?t.type="gif":t.recorderType===I?t.type="audio":t.recorderType===E&&(C(e,"audio").length&&C(e,"video").length||!C(e,"audio").length&&C(e,"video").length?t.type="video":C(e,"audio").length&&!C(e,"video").length&&(t.type="audio"))),void 0!==E&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function a(e,t){var o;return(v||f||p)&&(o=I),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!v&&(o=E),"video"===t.type&&(v||p)&&(o=M,void 0!==B&&"undefined"!=typeof ReadableStream&&(o=B)),"gif"===t.type&&(o=A),"canvas"===t.type&&(o=D),T()&&o!==D&&o!==A&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(C(e,"video").length||C(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(o=E):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(o=E)),e instanceof Array&&e.length&&(o=U),t.recorderType&&(o=t.recorderType),!t.disableLogs&&o&&o.name&&console.log("Using recorderType:",o.name||o.constructor.name),!o&&b&&(o=E),o}function c(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t,o=this.mediaType,n=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof o.audio&&T()&&!C(e,"audio").length&&(o.audio=!1),"function"!=typeof o.video&&T()&&!C(e,"video").length&&(o.video=!1),"function"!=typeof o.gif&&T()&&!C(e,"video").length&&(o.gif=!1),!o.audio&&!o.video&&!o.gif)throw"MediaStream must have either audio or video tracks.";if(o.audio&&(t=null,"function"==typeof o.audio&&(t=o.audio),this.audioRecorder=new r(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:n.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),o.video||this.audioRecorder.startRecording()),o.video){t=null,"function"==typeof o.video&&(t=o.video);var i=e;if(T()&&o.audio&&"function"==typeof o.audio){var s=C(e,"video")[0];m?((i=new w).addTrack(s),t&&t===M&&(t=E)):(i=new w).addTrack(s)}this.videoRecorder=new r(i,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:n.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),o.audio||this.videoRecorder.startRecording()}if(o.audio&&o.video){var a=this,c=!0===T();(o.audio instanceof I&&o.video||!0!==o.audio&&!0!==o.video&&o.audio!==o.video)&&(c=!1),!0===c?(a.audioRecorder=null,a.videoRecorder.startRecording()):a.videoRecorder.initRecorder((function(){a.audioRecorder.initRecorder((function(){a.videoRecorder.startRecording(),a.audioRecorder.startRecording()}))}))}o.gif&&(t=null,"function"==typeof o.gif&&(t=o.gif),this.gifRecorder=new r(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:n.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording((function(t){e(t,"audio")})),this.videoRecorder&&this.videoRecorder.stopRecording((function(t){e(t,"video")})),this.gifRecorder&&this.gifRecorder.stopRecording((function(t){e(t,"gif")}))},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var o=function(e){var t,o=g.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(o);if(void 0!==g)t=g;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(o),n}((function(e){postMessage((new FileReaderSync).readAsDataURL(e))}));o.onmessage=function(e){t(e.data)},o.postMessage(e)}else{var n=new FileReader;n.readAsDataURL(e),n.onload=function(e){t(e.target.result)}}}this.getBlob((function(o){o.audio&&o.video?t(o.audio,(function(n){t(o.video,(function(t){e({audio:n,video:t})}))})):o.audio?t(o.audio,(function(t){e({audio:t})})):o.video&&t(o.video,(function(t){e({video:t})}))}))},this.writeToDisk=function(){r.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}r.version="5.6.2",e.exports=r,void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n),r.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),L.Fetch((function(o,n){"all"!==e&&n===e+"Blob"&&t&&t(o),"all"===e&&t&&t(o,n.replace("Blob",""))}))},r.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL((function(t){e.video.getDataURL((function(o){e.gif.getDataURL((function(e){L.Store({audioBlob:t,videoBlob:o,gifBlob:e})}))}))})):e.audio&&e.video?e.audio.getDataURL((function(t){e.video.getDataURL((function(e){L.Store({audioBlob:t,videoBlob:e})}))})):e.audio&&e.gif?e.audio.getDataURL((function(t){e.gif.getDataURL((function(e){L.Store({audioBlob:t,gifBlob:e})}))})):e.video&&e.gif?e.video.getDataURL((function(t){e.gif.getDataURL((function(e){L.Store({videoBlob:t,gifBlob:e})}))})):e.audio?e.audio.getDataURL((function(e){L.Store({audioBlob:e})})):e.video?e.video.getDataURL((function(e){L.Store({videoBlob:e})})):e.gif&&e.gif.getDataURL((function(e){L.Store({gifBlob:e})}))},c.getFromDisk=r.getFromDisk,c.writeToDisk=r.writeToDisk,void 0!==r&&(r.MRecordRTC=c),(i=void 0!==o.g?o.g:null)&&"undefined"==typeof window&&void 0!==o.g&&(o.g.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},o.g.console||(o.g.console={}),void 0!==o.g.console.log&&void 0!==o.g.console.error||(o.g.console.error=o.g.console.log=o.g.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},i.HTMLVideoElement=function(){}),"undefined"==typeof location&&(i.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(i.screen={width:0,height:0}),void 0===g&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),i.window=o.g);var d=window.requestAnimationFrame;if(void 0===d)if("undefined"!=typeof webkitRequestAnimationFrame)d=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)d=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)d=msRequestAnimationFrame;else if(void 0===d){var l=0;d=function(e,t){var o=(new Date).getTime(),n=Math.max(0,16-(o-l)),i=setTimeout((function(){e(o+n)}),n);return l=o+n,i}}var h=window.cancelAnimationFrame;void 0===h&&("undefined"!=typeof webkitCancelAnimationFrame?h=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?h=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?h=msCancelAnimationFrame:void 0===h&&(h=function(e){clearTimeout(e)}));var u=window.AudioContext;void 0===u&&("undefined"!=typeof webkitAudioContext&&(u=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(u=mozAudioContext));var g=window.URL;void 0===g&&"undefined"!=typeof webkitURL&&(g=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var f=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),p=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),m=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),v=!p&&!f&&!!navigator.webkitGetUserMedia||S()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);b&&!v&&-1!==navigator.userAgent.indexOf("CriOS")&&(b=!1,v=!0);var w=window.MediaStream;function _(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function y(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var o=(e.type||"video/webm").split("/")[1];if(-1!==o.indexOf(";")&&(o=o.split(";")[0]),t&&-1!==t.indexOf(".")){var n=t.split(".");t=n[0],o=n[1]}var i=(t||Math.round(9999999999*Math.random())+888888888)+"."+o;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,i);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,i);var r=document.createElement("a");r.href=g.createObjectURL(e),r.download=i,r.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(r),"function"==typeof r.click?r.click():(r.target="_blank",r.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),g.revokeObjectURL(r.href)}function S(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}function C(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function R(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}void 0===w&&"undefined"!=typeof webkitMediaStream&&(w=webkitMediaStream),void 0!==w&&void 0===w.prototype.stop&&(w.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))}),void 0!==r&&(r.invokeSaveAsDialog=y,r.getTracks=C,r.getSeekableBlob=function(e,t){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var o=new EBML.Reader,n=new EBML.Decoder,i=EBML.tools,r=new FileReader;r.onload=function(e){n.decode(this.result).forEach((function(e){o.read(e)})),o.stop();var r=i.makeMetadataSeekable(o.metadatas,o.duration,o.cues),s=this.result.slice(o.metadataSize),a=new Blob([r,s],{type:"video/webm"});t(a)},r.readAsArrayBuffer(e)},r.bytesToSize=_,r.isElectron=S);var k={};function T(){if(m||b||f)return!0;navigator.appVersion;var e,t,o=navigator.userAgent,n=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10);return(v||p)&&(e=o.indexOf("Chrome"),n=o.substring(e+7)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),i=parseInt(""+n,10),isNaN(i)&&(n=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10)),i>=49}function E(e,t){var o,n=this;if(void 0===e)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";"audio"===(t=t||{mimeType:"video/webm"}).type&&(C(e,"video").length&&C(e,"audio").length&&(navigator.mozGetUserMedia?(o=new w).addTrack(C(e,"audio")[0]):o=new w(C(e,"audio")),e=o),t.mimeType&&-1!==t.mimeType.toString().toLowerCase().indexOf("audio")||(t.mimeType=v?"audio/webm":"audio/ogg"),t.mimeType&&"audio/ogg"!==t.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(t.mimeType="audio/ogg"));var i,r=[];function s(){n.timestamps.push((new Date).getTime()),"function"==typeof t.onTimeStamp&&t.onTimeStamp(n.timestamps[n.timestamps.length-1],n.timestamps)}function a(e){return i&&i.mimeType?i.mimeType:e.mimeType||"video/webm"}function c(){r=[],i=null,n.timestamps=[]}this.getArrayOfBlobs=function(){return r},this.record=function(){n.blob=null,n.clearRecordedData(),n.timestamps=[],d=[],r=[];var o=t;t.disableLogs||console.log("Passing following config over MediaRecorder API.",o),i&&(i=null),v&&!T()&&(o="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&o.mimeType&&(MediaRecorder.isTypeSupported(o.mimeType)||(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",o.mimeType),o.mimeType="audio"===t.type?"audio/webm":"video/webm"));try{i=new MediaRecorder(e,o),t.mimeType=o.mimeType}catch(t){i=new MediaRecorder(e)}o.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in i&&!1===i.canRecordMimeType(o.mimeType)&&(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",o.mimeType)),i.ondataavailable=function(e){if(e.data&&d.push("ondataavailable: "+_(e.data.size)),"number"!=typeof t.timeSlice)!e.data||!e.data.size||e.data.size<100||n.blob?n.recordingCallback&&(n.recordingCallback(new Blob([],{type:a(o)})),n.recordingCallback=null):(n.blob=t.getNativeBlob?e.data:new Blob([e.data],{type:a(o)}),n.recordingCallback&&(n.recordingCallback(n.blob),n.recordingCallback=null));else if(e.data&&e.data.size&&(r.push(e.data),s(),"function"==typeof t.ondataavailable)){var i=t.getNativeBlob?e.data:new Blob([e.data],{type:a(o)});t.ondataavailable(i)}},i.onstart=function(){d.push("started")},i.onpause=function(){d.push("paused")},i.onresume=function(){d.push("resumed")},i.onstop=function(){d.push("stopped")},i.onerror=function(e){e&&(e.name||(e.name="UnknownError"),d.push("error: "+e),t.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",o.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),function(e){if(!n.manuallyStopped&&i&&"inactive"===i.state)return delete t.timeslice,void i.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==i.state&&"stopped"!==i.state&&i.stop())},"number"==typeof t.timeSlice?(s(),i.start(t.timeSlice)):i.start(36e5),t.initCallback&&t.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},n.manuallyStopped=!0,i&&(this.recordingCallback=e,"recording"===i.state&&i.stop(),"number"==typeof t.timeSlice&&setTimeout((function(){n.blob=new Blob(r,{type:a(t)}),n.recordingCallback(n.blob)}),100))},this.pause=function(){i&&"recording"===i.state&&i.pause()},this.resume=function(){i&&"paused"===i.state&&i.resume()},this.clearRecordedData=function(){i&&"recording"===i.state&&n.stop(c),c()},this.getInternalRecorder=function(){return i},this.blob=null,this.getState=function(){return i&&i.state||"inactive"};var d=[];this.getAllStates=function(){return d},void 0===t.checkForInactiveTracks&&(t.checkForInactiveTracks=!1),n=this,function o(){if(i&&!1!==t.checkForInactiveTracks)return!1===function(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}()?(t.disableLogs||console.log("MediaStream seems stopped."),void n.stop()):void setTimeout(o,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function I(e,t){if(!C(e,"audio").length)throw"Your stream has no audio tracks.";var o,n=this,i=[],s=[],a=!1,c=0,d=2,l=(t=t||{}).desiredSampRate;function h(){if(!1===t.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function u(e,t){function o(e,t){var o,n=e.numberOfAudioChannels,i=e.leftBuffers.slice(0),r=e.rightBuffers.slice(0),s=e.sampleRate,a=e.internalInterleavedLength,c=e.desiredSampRate;function d(e,t,o){var n=Math.round(e.length*(t/o)),i=[],r=Number((e.length-1)/(n-1));i[0]=e[0];for(var s=1;s<n-1;s++){var a=s*r,c=Number(Math.floor(a)).toFixed(),d=Number(Math.ceil(a)).toFixed(),h=a-c;i[s]=l(e[c],e[d],h)}return i[n-1]=e[e.length-1],i}function l(e,t,o){return e+(t-e)*o}function h(e,t){for(var o=new Float64Array(t),n=0,i=e.length,r=0;r<i;r++){var s=e[r];o.set(s,n),n+=s.length}return o}function u(e,t,o){for(var n=o.length,i=0;i<n;i++)e.setUint8(t+i,o.charCodeAt(i))}2===n&&(i=h(i,a),r=h(r,a),c&&(i=d(i,c,s),r=d(r,c,s))),1===n&&(i=h(i,a),c&&(i=d(i,c,s))),c&&(s=c),2===n&&(o=function(e,t){for(var o=e.length+t.length,n=new Float64Array(o),i=0,r=0;r<o;)n[r++]=e[i],n[r++]=t[i],i++;return n}(i,r)),1===n&&(o=i);var g=o.length,f=new ArrayBuffer(44+2*g),p=new DataView(f);u(p,0,"RIFF"),p.setUint32(4,36+2*g,!0),u(p,8,"WAVE"),u(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,n,!0),p.setUint32(24,s,!0),p.setUint32(28,s*n*2,!0),p.setUint16(32,2*n,!0),p.setUint16(34,16,!0),u(p,36,"data"),p.setUint32(40,2*g,!0);for(var m=g,v=44,b=0;b<m;b++)p.setInt16(v,32767*o[b],!0),v+=2;if(t)return t({buffer:f,view:p});postMessage({buffer:f,view:p})}if(e.noWorker)o(e,(function(e){t(e.buffer,e.view)}));else{var n,i,r,s=(n=o,i=g.createObjectURL(new Blob([n.toString(),";this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),(r=new Worker(i)).workerURL=i,r);s.onmessage=function(e){t(e.data.buffer,e.data.view),g.revokeObjectURL(s.workerURL),s.terminate()},s.postMessage(e)}}!0===t.leftChannel&&(d=1),1===t.numberOfAudioChannels&&(d=1),(!d||d<1)&&(d=2),t.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+d),void 0===t.checkForInactiveTracks&&(t.checkForInactiveTracks=!0),this.record=function(){if(!1===h())throw"Please make sure MediaStream is active.";_(),S=w=!1,a=!0,void 0!==t.timeSlice&&k()},this.stop=function(e){e=e||function(){},a=!1,u({desiredSampRate:l,sampleRate:b,numberOfAudioChannels:d,internalInterleavedLength:c,leftBuffers:i,rightBuffers:1===d?[]:s,noWorker:t.noWorker},(function(t,o){n.blob=new Blob([o],{type:"audio/wav"}),n.buffer=new ArrayBuffer(o.buffer.byteLength),n.view=o,n.sampleRate=l||b,n.bufferSize=v,n.length=c,S=!1,e&&e(n.blob)}))},void 0===r.Storage&&(r.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),r.Storage.AudioContextConstructor&&"closed"!==r.Storage.AudioContextConstructor.state||(r.Storage.AudioContextConstructor=new r.Storage.AudioContext);var f=r.Storage.AudioContextConstructor,p=f.createMediaStreamSource(e),m=[0,256,512,1024,2048,4096,8192,16384],v=void 0===t.bufferSize?4096:t.bufferSize;if(-1===m.indexOf(v)&&(t.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(m,null,"\t"))),f.createJavaScriptNode)o=f.createJavaScriptNode(v,d,d);else{if(!f.createScriptProcessor)throw"WebAudio API has no support on this browser.";o=f.createScriptProcessor(v,d,d)}p.connect(o),t.bufferSize||(v=o.bufferSize);var b=void 0!==t.sampleRate?t.sampleRate:f.sampleRate||44100;(b<22050||b>96e3)&&(t.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),t.disableLogs||t.desiredSampRate&&console.log("Desired sample-rate: "+t.desiredSampRate);var w=!1;function _(){i=[],s=[],c=0,S=!1,a=!1,w=!1,f=null,n.leftchannel=i,n.rightchannel=s,n.numberOfAudioChannels=d,n.desiredSampRate=l,n.sampleRate=b,n.recordingLength=c,R={left:[],right:[],recordingLength:0}}function y(){o&&(o.onaudioprocess=null,o.disconnect(),o=null),p&&(p.disconnect(),p=null),_()}this.pause=function(){w=!0},this.resume=function(){if(!1===h())throw"Please make sure MediaStream is active.";if(!a)return t.disableLogs||console.log("Seems recording has been restarted."),void this.record();w=!1},this.clearRecordedData=function(){t.checkForInactiveTracks=!1,a&&this.stop(y),y()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var S=!1;o.onaudioprocess=function(e){if(!w)if(!1===h()&&(t.disableLogs||console.log("MediaStream seems stopped."),o.disconnect(),a=!1),a){S||(S=!0,t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback());var r=e.inputBuffer.getChannelData(0),l=new Float32Array(r);if(i.push(l),2===d){var u=e.inputBuffer.getChannelData(1),g=new Float32Array(u);s.push(g)}c+=v,n.recordingLength=c,void 0!==t.timeSlice&&(R.recordingLength+=v,R.left.push(l),2===d&&R.right.push(g))}else p&&(p.disconnect(),p=null)},f.createMediaStreamDestination?o.connect(f.createMediaStreamDestination()):o.connect(f.destination),this.leftchannel=i,this.rightchannel=s,this.numberOfAudioChannels=d,this.desiredSampRate=l,this.sampleRate=b,n.recordingLength=c;var R={left:[],right:[],recordingLength:0};function k(){a&&"function"==typeof t.ondataavailable&&void 0!==t.timeSlice&&(R.left.length?(u({desiredSampRate:l,sampleRate:b,numberOfAudioChannels:d,internalInterleavedLength:R.recordingLength,leftBuffers:R.left,rightBuffers:1===d?[]:R.right},(function(e,o){var n=new Blob([o],{type:"audio/wav"});t.ondataavailable(n),setTimeout(k,t.timeSlice)})),R={left:[],right:[],recordingLength:0}):setTimeout(k,t.timeSlice))}}function D(e,t){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(t=t||{}).frameInterval||(t.frameInterval=10);var o=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){e in document.createElement("canvas")&&(o=!0)}));var n,i,r,s=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),a=50,c=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(s&&c&&c[2]&&(a=parseInt(c[2],10)),s&&a<52&&(o=!1),t.useWhammyRecorder&&(o=!1),o)if(t.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)n=e;else{if(!(e instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";n=e.canvas}else navigator.mozGetUserMedia&&(t.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(r=!0,o&&!t.useWhammyRecorder){var e;"captureStream"in n?e=n.captureStream(25):"mozCaptureStream"in n?e=n.mozCaptureStream(25):"webkitCaptureStream"in n&&(e=n.webkitCaptureStream(25));try{var s=new w;s.addTrack(C(e,"video")[0]),e=s}catch(e){}if(!e)throw"captureStream API are NOT available.";(i=new E(e,{mimeType:t.mimeType||"video/webm"})).record()}else g.frames=[],u=(new Date).getTime(),h();t.initCallback&&t.initCallback()},this.getWebPImages=function(o){if("canvas"===e.nodeName.toLowerCase()){var n=g.frames.length;g.frames.forEach((function(e,o){var i=n-o;t.disableLogs||console.log(i+"/"+n+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(i,n);var r=e.image.toDataURL("image/webp",1);g.frames[o].image=r})),t.disableLogs||console.log("Generating WebM"),o()}else o()},this.stop=function(e){r=!1;var n=this;o&&i?i.stop(e):this.getWebPImages((function(){g.compile((function(o){t.disableLogs||console.log("Recording finished!"),n.blob=o,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),e&&e(n.blob),g.frames=[]}))}))};var d=!1;function l(){g.frames=[],r=!1,d=!1}function h(){if(d)return u=(new Date).getTime(),setTimeout(h,500);if("canvas"===e.nodeName.toLowerCase()){var o=(new Date).getTime()-u;return u=(new Date).getTime(),g.frames.push({image:(n=document.createElement("canvas"),i=n.getContext("2d"),n.width=e.width,n.height=e.height,i.drawImage(e,0,0),n),duration:o}),void(r&&setTimeout(h,t.frameInterval))}var n,i;html2canvas(e,{grabMouse:void 0===t.showMousePointer||t.showMousePointer,onrendered:function(e){var o=(new Date).getTime()-u;if(!o)return setTimeout(h,t.frameInterval);u=(new Date).getTime(),g.frames.push({image:e.toDataURL("image/webp",1),duration:o}),r&&setTimeout(h,t.frameInterval)}})}this.pause=function(){d=!0,i instanceof E&&i.pause()},this.resume=function(){d=!1,i instanceof E?i.resume():r||this.record()},this.clearRecordedData=function(){r&&this.stop(l),l()},this.name="CanvasRecorder",this.toString=function(){return this.name};var u=(new Date).getTime(),g=new P.Video(100)}function M(e,t){function o(e){e=void 0!==e?e:10;var t=(new Date).getTime()-a;return t?i?(a=(new Date).getTime(),setTimeout(o,100)):(a=(new Date).getTime(),s.paused&&s.play(),l.drawImage(s,0,0,d.width,d.height),c.frames.push({duration:t,image:d.toDataURL("image/webp")}),void(n||setTimeout(o,e,e))):setTimeout(o,e,e)}(t=t||{}).frameInterval||(t.frameInterval=10),t.disableLogs||console.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),d.width=t.canvas.width||320,d.height=t.canvas.height||240,l=d.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(s=t.video.cloneNode(),t.initCallback&&t.initCallback()):(s=document.createElement("video"),R(e,s),s.onloadedmetadata=function(){t.initCallback&&t.initCallback()},s.width=t.video.width,s.height=t.video.height),s.muted=!0,s.play(),a=(new Date).getTime(),c=new P.Video,t.disableLogs||(console.log("canvas resolutions",d.width,"*",d.height),console.log("video width/height",s.width||d.width,"*",s.height||d.height)),o(t.frameInterval)};var n=!1;this.stop=function(e){e=e||function(){},n=!0;var o=this;setTimeout((function(){!function(e,t,o,n,i){var r=document.createElement("canvas");r.width=d.width,r.height=d.height;var s,a,c,l=r.getContext("2d"),h=[],u=-1===t,g=t&&t>0&&t<=e.length?t:e.length,f=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),p=o&&o>=0&&o<=1?o:0,m=n&&n>=0&&n<=1?n:0,v=!1;a=-1,c=(s={length:g,functionToLoop:function(t,o){var n,i,r,s=function(){!v&&r-n<=r*m||(u&&(v=!0),h.push(e[o])),t()};if(v)s();else{var a=new Image;a.onload=function(){l.drawImage(a,0,0,d.width,d.height);var e=l.getImageData(0,0,d.width,d.height);n=0,i=e.data.length,r=e.data.length/4;for(var t=0;t<i;t+=4){var o={r:e.data[t],g:e.data[t+1],b:e.data[t+2]};Math.sqrt(Math.pow(o.r-0,2)+Math.pow(o.g-0,2)+Math.pow(o.b-0,2))<=f*p&&n++}s()},a.src=e[o].image}},callback:function(){(h=h.concat(e.slice(g))).length<=0&&h.push(e[e.length-1]),i(h)}}).length,function e(){++a!==c?setTimeout((function(){s.functionToLoop(e,a)}),1):s.callback()}()}(c.frames,-1,null,null,(function(n){c.frames=n,t.advertisement&&t.advertisement.length&&(c.frames=t.advertisement.concat(c.frames)),c.compile((function(t){o.blob=t,o.blob.forEach&&(o.blob=new Blob([],{type:"video/webm"})),e&&e(o.blob)}))}))}),10)};var i=!1;function r(){c.frames=[],n=!0,i=!1}this.pause=function(){i=!0},this.resume=function(){i=!1,n&&this.record()},this.clearRecordedData=function(){n||this.stop(r),r()},this.name="WhammyRecorder",this.toString=function(){return this.name};var s,a,c,d=document.createElement("canvas"),l=d.getContext("2d")}void 0!==u?k.AudioContext=u:"undefined"!=typeof webkitAudioContext&&(k.AudioContext=webkitAudioContext),void 0!==r&&(r.Storage=k),void 0!==r&&(r.MediaStreamRecorder=E),void 0!==r&&(r.StereoAudioRecorder=I),void 0!==r&&(r.CanvasRecorder=D),void 0!==r&&(r.WhammyRecorder=M);var P=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){function t(e,t,o){return[{data:e,id:231}].concat(o.map((function(e){var o=function(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map((function(e){return String.fromCharCode(e)})).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:o,id:163}})))}function o(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function n(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var o=0;o<e.length;o+=8)t.push(parseInt(e.substr(o,8),2));return new Uint8Array(t)}function i(e){for(var t=[],r=0;r<e.length;r++){var s=e[r].data;"object"==typeof s&&(s=i(s)),"number"==typeof s&&(s=n(s.toString(2))),"string"==typeof s&&(s=new Uint8Array(s.split("").map((function(e){return e.charCodeAt(0)}))));var a=s.size||s.byteLength||s.length,c=Math.ceil(Math.ceil(Math.log(a)/Math.log(2))/8),d=a.toString(2),l=new Array(7*c+7+1-d.length).join("0")+d,h=new Array(c).join("0")+"1"+l;t.push(o(e[r].id)),t.push(n(h)),t.push(s)}return new Blob(t,{type:"video/webm"})}function r(e,t){return parseInt(e.substr(t+4,4).split("").map((function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t})).join(""),2)}function s(e){for(var t=0,o={};t<e.length;){var n=e.substr(t,4),i=r(e,t),a=e.substr(t+4+4,i);t+=8+i,o[n]=o[n]||[],"RIFF"===n||"LIST"===n?o[n].push(s(a)):o[n].push(a)}return o}var a=new function(e){var o=function(e){if(e[0]){for(var t=e[0].width,o=e[0].height,n=e[0].duration,i=1;i<e.length;i++)n+=e[i].duration;return{duration:n,width:t,height:o}}postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."})}(e);if(!o)return[];for(var n,r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(n=o.duration,[].slice.call(new Uint8Array(new Float64Array([n]).buffer),0).map((function(e){return String.fromCharCode(e)})).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:o.width,id:176},{data:o.height,id:186}]}]}]}]}],s=0,a=0;s<e.length;){var c=[],d=0;do{c.push(e[s]),d+=e[s].duration,s++}while(s<e.length&&d<3e4);var l={id:524531317,data:t(a,0,c)};r[1].data.push(l),a+=d}return i(r)}(e.map((function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],o=t.indexOf("Â*"),n=0,i=[];n<4;n++)i[n]=t.charCodeAt(o+3+n);return{width:16383&(i[1]<<8|i[0]),height:16383&(i[3]<<8|i[2]),data:t,riff:e}}(s(atob(e.image.slice(23))));return t.duration=e.duration,t})));postMessage(a)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var o,n,i,r=(o=t,n=g.createObjectURL(new Blob([o.toString(),"this.onmessage =  function (eee) {"+o.name+"(eee.data);}"],{type:"application/javascript"})),i=new Worker(n),g.revokeObjectURL(n),i);r.onmessage=function(t){t.data.error?console.error(t.data.error):e(t.data)},r.postMessage(this.frames)},{Video:e}}();void 0!==r&&(r.Whammy=P);var L={init:function(){var e=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var t,o=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),n=indexedDB.open(o,1);n.onerror=e.onError,n.onsuccess=function(){(t=n.result).onerror=e.onError,t.setVersion&&1!==t.version?t.setVersion(1).onsuccess=function(){i(t),r()}:r()},n.onupgradeneeded=function(e){i(e.target.result)}}else console.error("IndexedDB API are not available in this browser.");function i(t){t.createObjectStore(e.dataStoreName)}function r(){var o=t.transaction([e.dataStoreName],"readwrite");function n(t){o.objectStore(e.dataStoreName).get(t).onsuccess=function(o){e.callback&&e.callback(o.target.result,t)}}e.videoBlob&&o.objectStore(e.dataStoreName).put(e.videoBlob,"videoBlob"),e.gifBlob&&o.objectStore(e.dataStoreName).put(e.gifBlob,"gifBlob"),e.audioBlob&&o.objectStore(e.dataStoreName).put(e.audioBlob,"audioBlob"),n("audioBlob"),n("videoBlob"),n("gifBlob")}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function A(e,t){if("undefined"==typeof GIFEncoder){var o=document.createElement("script");o.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(o)}t=t||{};var n=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&a?(n||(t.width||(t.width=c.offsetWidth||320),t.height||(t.height=c.offsetHeight||240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),r.width=t.canvas.width||320,r.height=t.canvas.height||240,c.width=t.video.width||320,c.height=t.video.height||240),(u=new GIFEncoder).setRepeat(0),u.setDelay(t.frameRate||200),u.setQuality(t.quality||10),u.start(),"function"==typeof t.onGifRecordingStarted&&t.onGifRecordingStarted(),Date.now(),g=d((function e(o){if(!0!==f.clearedRecordedData){if(i)return setTimeout((function(){e(o)}),100);g=d(e),void 0===typeof l&&(l=o),o-l<90||(!n&&c.paused&&c.play(),n||s.drawImage(c,0,0,r.width,r.height),t.onGifPreview&&t.onGifPreview(r.toDataURL("image/png")),u.addFrame(s),l=o)}})),t.initCallback&&t.initCallback()):setTimeout(f.record,1e3)},this.stop=function(e){e=e||function(){},g&&h(g),Date.now(),this.blob=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"}),e(this.blob),u.stream().bin=[]};var i=!1;this.pause=function(){i=!0},this.resume=function(){i=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,u&&(u.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var r=document.createElement("canvas"),s=r.getContext("2d");n&&(e instanceof CanvasRenderingContext2D?r=(s=e).canvas:e instanceof HTMLCanvasElement&&(s=e.getContext("2d"),r=e));var a=!0;if(!n){var c=document.createElement("video");c.muted=!0,c.autoplay=!0,c.playsInline=!0,a=!1,c.onloadedmetadata=function(){a=!0},R(e,c),c.play()}var l,u,g=null,f=this}function x(e,t){!function(e){void 0===r&&e&&"undefined"==typeof window&&void 0!==o.g&&(o.g.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},o.g.console||(o.g.console={}),void 0!==o.g.console.log&&void 0!==o.g.console.error||(o.g.console.error=o.g.console.log=o.g.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),void 0===l&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=o.g)}(void 0!==o.g?o.g:null),t=t||"multi-streams-mixer";var n=[],i=!1,s=document.createElement("canvas"),a=s.getContext("2d");s.style.opacity=0,s.style.position="absolute",s.style.zIndex=-1,s.style.top="-1000em",s.style.left="-1000em",s.className=t,(document.body||document.documentElement).appendChild(s),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var c=this,d=window.AudioContext;void 0===d&&("undefined"!=typeof webkitAudioContext&&(d=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(d=mozAudioContext));var l=window.URL;void 0===l&&"undefined"!=typeof webkitURL&&(l=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=window.MediaStream;void 0===h&&"undefined"!=typeof webkitMediaStream&&(h=webkitMediaStream),void 0!==h&&void 0===h.prototype.stop&&(h.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))});var u={};function g(){if(!i){var e=n.length,t=!1,o=[];if(n.forEach((function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:o.push(e)})),t)s.width=t.stream.width,s.height=t.stream.height;else if(o.length){s.width=e>1?2*o[0].width:o[0].width;var r=1;3!==e&&4!==e||(r=2),5!==e&&6!==e||(r=3),7!==e&&8!==e||(r=4),9!==e&&10!==e||(r=5),s.height=o[0].height*r}else s.width=c.width||360,s.height=c.height||240;t&&t instanceof HTMLVideoElement&&f(t),o.forEach((function(e,t){f(e,t)})),setTimeout(g,c.frameInterval)}}function f(e,t){if(!i){var o=0,n=0,r=e.width,s=e.height;1===t&&(o=e.width),2===t&&(n=e.height),3===t&&(o=e.width,n=e.height),4===t&&(n=2*e.height),5===t&&(o=e.width,n=2*e.height),6===t&&(n=3*e.height),7===t&&(o=e.width,n=3*e.height),void 0!==e.stream.left&&(o=e.stream.left),void 0!==e.stream.top&&(n=e.stream.top),void 0!==e.stream.width&&(r=e.stream.width),void 0!==e.stream.height&&(s=e.stream.height),a.drawImage(e,o,n,r,s),"function"==typeof e.stream.onRender&&e.stream.onRender(a,o,n,r,s,t)}}function p(e){var o=document.createElement("video");return function(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}(e,o),o.className=t,o.muted=!0,o.volume=0,o.width=e.width||c.width||360,o.height=e.height||c.height||240,o.play(),o}function m(t){n=[],(t=t||e).forEach((function(e){if(e.getTracks().filter((function(e){return"video"===e.kind})).length){var t=p(e);t.stream=e,n.push(t)}}))}void 0!==d?u.AudioContext=d:"undefined"!=typeof webkitAudioContext&&(u.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){g()},this.appendStreams=function(t){if(!t)throw"First parameter is required.";t instanceof Array||(t=[t]),t.forEach((function(t){var o=new h;if(t.getTracks().filter((function(e){return"video"===e.kind})).length){var i=p(t);i.stream=t,n.push(i),o.addTrack(t.getTracks().filter((function(e){return"video"===e.kind}))[0])}if(t.getTracks().filter((function(e){return"audio"===e.kind})).length){var r=c.audioContext.createMediaStreamSource(t);c.audioDestination=c.audioContext.createMediaStreamDestination(),r.connect(c.audioDestination),o.addTrack(c.audioDestination.stream.getTracks().filter((function(e){return"audio"===e.kind}))[0])}e.push(o)}))},this.releaseStreams=function(){n=[],i=!0,c.gainNode&&(c.gainNode.disconnect(),c.gainNode=null),c.audioSources.length&&(c.audioSources.forEach((function(e){e.disconnect()})),c.audioSources=[]),c.audioDestination&&(c.audioDestination.disconnect(),c.audioDestination=null),c.audioContext&&c.audioContext.close(),c.audioContext=null,a.clearRect(0,0,s.width,s.height),s.stream&&(s.stream.stop(),s.stream=null)},this.resetVideoStreams=function(e){!e||e instanceof Array||(e=[e]),m(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){i=!1;var t=function(){var e;m(),"captureStream"in s?e=s.captureStream():"mozCaptureStream"in s?e=s.mozCaptureStream():c.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new h;return e.getTracks().filter((function(e){return"video"===e.kind})).forEach((function(e){t.addTrack(e)})),s.stream=t,t}(),o=function(){u.AudioContextConstructor||(u.AudioContextConstructor=new u.AudioContext),c.audioContext=u.AudioContextConstructor,c.audioSources=[],!0===c.useGainNode&&(c.gainNode=c.audioContext.createGain(),c.gainNode.connect(c.audioContext.destination),c.gainNode.gain.value=0);var t=0;if(e.forEach((function(e){if(e.getTracks().filter((function(e){return"audio"===e.kind})).length){t++;var o=c.audioContext.createMediaStreamSource(e);!0===c.useGainNode&&o.connect(c.gainNode),c.audioSources.push(o)}})),t)return c.audioDestination=c.audioContext.createMediaStreamDestination(),c.audioSources.forEach((function(e){e.connect(c.audioDestination)})),c.audioDestination.stream}();return o&&o.getTracks().filter((function(e){return"audio"===e.kind})).forEach((function(e){t.addTrack(e)})),e.forEach((function(e){e.fullcanvas})),t}}function U(e,t){e=e||[];var o,n,i=this;(t=t||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(t.frameInterval=10),t.video||(t.video={}),t.video.width||(t.video.width=360),t.video.height||(t.video.height=240),this.record=function(){var i;o=new x(e,t.elementClass||"multi-streams-mixer"),(i=[],e.forEach((function(e){C(e,"video").forEach((function(e){i.push(e)}))})),i).length&&(o.frameInterval=t.frameInterval||10,o.width=t.video.width||360,o.height=t.video.height||240,o.startDrawingFrames()),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(o.getMixedStream()),(n=new E(o.getMixedStream(),t)).record()},this.stop=function(e){n&&n.stop((function(t){i.blob=t,e(t),i.clearRecordedData()}))},this.pause=function(){n&&n.pause()},this.resume=function(){n&&n.resume()},this.clearRecordedData=function(){n&&(n.clearRecordedData(),n=null),o&&(o.releaseStreams(),o=null)},this.addStreams=function(i){if(!i)throw"First parameter is required.";i instanceof Array||(i=[i]),e.concat(i),n&&o&&(o.appendStreams(i),t.previewStream&&"function"==typeof t.previewStream&&t.previewStream(o.getMixedStream()))},this.resetVideoStreams=function(e){o&&(!e||e instanceof Array||(e=[e]),o.resetVideoStreams(e))},this.getMixer=function(){return o},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function B(e,t){var o,n,i;function r(){return new ReadableStream({start:function(n){var i=document.createElement("canvas"),r=document.createElement("video"),s=!0;r.srcObject=e,r.muted=!0,r.height=t.height,r.width=t.width,r.volume=0,r.onplaying=function(){i.width=t.width,i.height=t.height;var e=i.getContext("2d"),a=1e3/t.frameRate,c=setInterval((function(){if(o&&(clearInterval(c),n.close()),s&&(s=!1,t.onVideoProcessStarted&&t.onVideoProcessStarted()),e.drawImage(r,0,0),"closed"!==n._controlledReadableStream.state)try{n.enqueue(e.getImageData(0,0,t.width,t.height))}catch(e){}}),a)},r.play()}})}function s(e,c){if(!t.workerPath&&!c)return o=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then((function(t){t.arrayBuffer().then((function(t){s(e,t)}))}));if(!t.workerPath&&c instanceof ArrayBuffer){var d=new Blob([c],{type:"text/javascript"});t.workerPath=g.createObjectURL(d)}t.workerPath||console.error("workerPath parameter is missing."),(n=new Worker(t.workerPath)).postMessage(t.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),n.addEventListener("message",(function(e){"READY"===e.data?(n.postMessage({width:t.width,height:t.height,bitrate:t.bitrate||1200,timebaseDen:t.frameRate||30,realtime:t.realtime}),r().pipeTo(new WritableStream({write:function(e){o?console.error("Got image, but recorder is finished!"):n.postMessage(e.data.buffer,[e.data.buffer])}}))):e.data&&(i||a.push(e.data))}))}"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(t=t||{}).width=t.width||640,t.height=t.height||480,t.frameRate=t.frameRate||30,t.bitrate=t.bitrate||1200,t.realtime=t.realtime||!0,this.record=function(){a=[],i=!1,this.blob=null,s(e),"function"==typeof t.initCallback&&t.initCallback()},this.pause=function(){i=!0},this.resume=function(){i=!1};var a=[];this.stop=function(e){o=!0;var t=this;!function(e){n?(n.addEventListener("message",(function(t){null===t.data&&(n.terminate(),n=null,e&&e())})),n.postMessage(null)):e&&e()}((function(){t.blob=new Blob(a,{type:"video/webm"}),e(t.blob)}))},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){a=[],i=!1,this.blob=null},this.blob=null}void 0!==r&&(r.DiskStorage=L),void 0!==r&&(r.GifRecorder=A),void 0===r&&(e.exports=x,void 0===(n=function(){return x}.apply(t,[]))||(e.exports=n)),void 0!==r&&(r.MultiStreamRecorder=U),void 0!==r&&(r.RecordRTCPromisesHandler=function(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var o=this;o.recordRTC=new r(e,t),this.startRecording=function(){return new Promise((function(e,t){try{o.recordRTC.startRecording(),e()}catch(e){t(e)}}))},this.stopRecording=function(){return new Promise((function(e,t){try{o.recordRTC.stopRecording((function(n){o.blob=o.recordRTC.getBlob(),o.blob&&o.blob.size?e(n):t("Empty blob.",o.blob)}))}catch(e){t(e)}}))},this.pauseRecording=function(){return new Promise((function(e,t){try{o.recordRTC.pauseRecording(),e()}catch(e){t(e)}}))},this.resumeRecording=function(){return new Promise((function(e,t){try{o.recordRTC.resumeRecording(),e()}catch(e){t(e)}}))},this.getDataURL=function(e){return new Promise((function(e,t){try{o.recordRTC.getDataURL((function(t){e(t)}))}catch(e){t(e)}}))},this.getBlob=function(){return new Promise((function(e,t){try{e(o.recordRTC.getBlob())}catch(e){t(e)}}))},this.getInternalRecorder=function(){return new Promise((function(e,t){try{e(o.recordRTC.getInternalRecorder())}catch(e){t(e)}}))},this.reset=function(){return new Promise((function(e,t){try{e(o.recordRTC.reset())}catch(e){t(e)}}))},this.destroy=function(){return new Promise((function(e,t){try{e(o.recordRTC.destroy())}catch(e){t(e)}}))},this.getState=function(){return new Promise((function(e,t){try{e(o.recordRTC.getState())}catch(e){t(e)}}))},this.blob=null,this.version="5.6.2"}),void 0!==r&&(r.WebAssemblyRecorder=B)},720:()=>{},194:()=>{},236:()=>{},676:()=>{},611:()=>{},449:()=>{}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";var e=o(412);const t=[0,2e3,1e4,3e4,null];class n{constructor(e){this._retryDelays=void 0!==e?[...e,null]:t}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class i{}i.Authorization="Authorization",i.Cookie="Cookie";class r{constructor(e,t,o){this.statusCode=e,this.statusText=t,this.content=o}}class s{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}class a extends s{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const o=await this._innerClient.send(e);return t&&401===o.statusCode&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):o}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[i.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[i.Authorization]&&delete e.headers[i.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}class c extends Error{constructor(e,t){const o=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class d extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class l extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class h extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class u extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class g extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class f extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class p extends Error{constructor(e,t){const o=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=o}}var m;!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(m||(m={}));class v{constructor(){}log(e,t){}}v.instance=new v;const b="8.0.0";class w{static isRequired(e,t){if(null==e)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,o){if(!(e in t))throw new Error(`Unknown ${o} value: ${e}.`)}}class _{static get isBrowser(){return!_.isNode&&"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return!_.isNode&&"object"==typeof self&&"importScripts"in self}static get isReactNative(){return!_.isNode&&"object"==typeof window&&void 0===window.document}static get isNode(){return"undefined"!=typeof process&&process.release&&"node"===process.release.name}}function y(e,t){let o="";return S(e)?(o=`Binary data of length ${e.byteLength}`,t&&(o+=`. Content: '${function(e){const t=new Uint8Array(e);let o="";return t.forEach((e=>{o+=`0x${e<16?"0":""}${e.toString(16)} `})),o.substr(0,o.length-1)}(e)}'`)):"string"==typeof e&&(o=`String data of length ${e.length}`,t&&(o+=`. Content: '${e}'`)),o}function S(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}async function C(e,t,o,n,i,r){const s={},[a,c]=T();s[a]=c,e.log(m.Trace,`(${t} transport) sending data. ${y(i,r.logMessageContent)}.`);const d=S(i)?"arraybuffer":"text",l=await o.post(n,{content:i,headers:{...s,...r.headers},responseType:d,timeout:r.timeout,withCredentials:r.withCredentials});e.log(m.Trace,`(${t} transport) request complete. Response status: ${l.statusCode}.`)}class R{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch((e=>{}))}}class k{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const o=`[${(new Date).toISOString()}] ${m[e]}: ${t}`;switch(e){case m.Critical:case m.Error:this.out.error(o);break;case m.Warning:this.out.warn(o);break;case m.Information:this.out.info(o);break;default:this.out.log(o)}}}}function T(){let e="X-SignalR-User-Agent";return _.isNode&&(e="User-Agent"),[e,E(b,I(),_.isNode?"NodeJS":"Browser",D())]}function E(e,t,o,n){let i="Microsoft SignalR/";const r=e.split(".");return i+=`${r[0]}.${r[1]}`,i+=` (${e}; `,i+=t&&""!==t?`${t}; `:"Unknown OS; ",i+=`${o}`,i+=n?`; ${n}`:"; Unknown Runtime Version",i+=")",i}function I(){if(!_.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function D(){if(_.isNode)return process.versions.node}function M(e){return e.stack?e.stack:e.message?e.message:`${e}`}class P extends s{constructor(e){super(),this._logger=e;const t={_fetchType:void 0,_jar:void 0};var n;n=t,("undefined"==typeof fetch||_.isNode)&&(n._jar=new(o(611).CookieJar),"undefined"==typeof fetch?n._fetchType=o(676):n._fetchType=fetch,n._fetchType=o(236)(n._fetchType,n._jar),1)?(this._fetchType=t._fetchType,this._jar=t._jar):this._fetchType=fetch.bind(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==o.g)return o.g;throw new Error("could not find global")}()),this._abortControllerType=AbortController;const i={_abortControllerType:this._abortControllerType};(function(e){return"undefined"==typeof AbortController&&(e._abortControllerType=o(720),!0)})(i)&&(this._abortControllerType=i._abortControllerType)}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new l;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let o;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),o=new l});let n,i=null;if(e.timeout){const n=e.timeout;i=setTimeout((()=>{t.abort(),this._logger.log(m.Warning,"Timeout from HTTP request."),o=new d}),n)}""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},S(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{n=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(o)throw o;throw this._logger.log(m.Warning,`Error from HTTP request. ${e}.`),e}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!n.ok){const e=await L(n,"text");throw new c(e||n.statusText,n.status)}const s=L(n,e.responseType),a=await s;return new r(n.status,n.statusText,a)}getCookieString(e){let t="";return _.isNode&&this._jar&&this._jar.getCookies(e,((e,o)=>t=o.join("; "))),t}}function L(e,t){let o;switch(t){case"arraybuffer":o=e.arrayBuffer();break;case"text":default:o=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return o}class A extends s{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new l):e.method?e.url?new Promise(((t,o)=>{const n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.withCredentials=void 0===e.withCredentials||e.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===e.content&&(e.content=void 0),e.content&&(S(e.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const i=e.headers;i&&Object.keys(i).forEach((e=>{n.setRequestHeader(e,i[e])})),e.responseType&&(n.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{n.abort(),o(new l)}),e.timeout&&(n.timeout=e.timeout),n.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),n.status>=200&&n.status<300?t(new r(n.status,n.statusText,n.response||n.responseText)):o(new c(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(m.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),o(new c(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(m.Warning,"Timeout from HTTP request."),o(new d)},n.send(e.content)})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class x extends s{constructor(e){if(super(),"undefined"!=typeof fetch||_.isNode)this._httpClient=new P(e);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");this._httpClient=new A(e)}}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new l):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}var U,B,j,O;!function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"}(U||(U={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(B||(B={}));class F{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class N{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,o){this._httpClient=e,this._logger=t,this._pollAbort=new F,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(w.isRequired(e,"url"),w.isRequired(t,"transferFormat"),w.isIn(t,B,"transferFormat"),this._url=e,this._logger.log(m.Trace,"(LongPolling transport) Connecting."),t===B.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[o,n]=T(),i={[o]:n,...this._options.headers},r={abortSignal:this._pollAbort.signal,headers:i,timeout:1e5,withCredentials:this._options.withCredentials};t===B.Binary&&(r.responseType="arraybuffer");const s=`${e}&_=${Date.now()}`;this._logger.log(m.Trace,`(LongPolling transport) polling: ${s}.`);const a=await this._httpClient.get(s,r);200!==a.statusCode?(this._logger.log(m.Error,`(LongPolling transport) Unexpected response code: ${a.statusCode}.`),this._closeError=new c(a.statusText||"",a.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,r)}async _poll(e,t){try{for(;this._running;)try{const o=`${e}&_=${Date.now()}`;this._logger.log(m.Trace,`(LongPolling transport) polling: ${o}.`);const n=await this._httpClient.get(o,t);204===n.statusCode?(this._logger.log(m.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):200!==n.statusCode?(this._logger.log(m.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new c(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(m.Trace,`(LongPolling transport) data received. ${y(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(m.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(e){this._running?e instanceof d?this._logger.log(m.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=e,this._running=!1):this._logger.log(m.Trace,`(LongPolling transport) Poll errored after shutdown: ${e.message}`)}}finally{this._logger.log(m.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?C(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(m.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(m.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,o]=T();e[t]=o;const n={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let i;try{await this._httpClient.delete(this._url,n)}catch(e){i=e}i?i instanceof c&&(404===i.statusCode?this._logger.log(m.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(m.Trace,`(LongPolling transport) Error sending a DELETE request: ${i}`)):this._logger.log(m.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(m.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(m.Trace,e),this.onclose(this._closeError)}}}class q{constructor(e,t,o,n){this._httpClient=e,this._accessToken=t,this._logger=o,this._options=n,this.onreceive=null,this.onclose=null}async connect(e,t){return w.isRequired(e,"url"),w.isRequired(t,"transferFormat"),w.isIn(t,B,"transferFormat"),this._logger.log(m.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise(((o,n)=>{let i,r=!1;if(t===B.Text){if(_.isBrowser||_.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const t=this._httpClient.getCookieString(e),o={};o.Cookie=t;const[n,r]=T();o[n]=r,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...o,...this._options.headers}})}try{i.onmessage=e=>{if(this.onreceive)try{this._logger.log(m.Trace,`(SSE transport) data received. ${y(e.data,this._options.logMessageContent)}.`),this.onreceive(e.data)}catch(e){return void this._close(e)}},i.onerror=e=>{r?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(m.Information,`SSE connected to ${this._url}`),this._eventSource=i,r=!0,o()}}catch(e){return void n(e)}}else n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))}async send(e){return this._eventSource?C(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class W{constructor(e,t,o,n,i,r){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=n,this._webSocketConstructor=i,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=r}async connect(e,t){let o;return w.isRequired(e,"url"),w.isRequired(t,"transferFormat"),w.isIn(t,B,"transferFormat"),this._logger.log(m.Trace,"(WebSockets transport) Connecting."),this._accessTokenFactory&&(o=await this._accessTokenFactory()),new Promise(((n,r)=>{let s;e=e.replace(/^http/,"ws");const a=this._httpClient.getCookieString(e);let c=!1;if(_.isNode||_.isReactNative){const t={},[n,r]=T();t[n]=r,o&&(t[i.Authorization]=`Bearer ${o}`),a&&(t[i.Cookie]=a),s=new this._webSocketConstructor(e,void 0,{headers:{...t,...this._headers}})}else o&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o)}`);s||(s=new this._webSocketConstructor(e)),t===B.Binary&&(s.binaryType="arraybuffer"),s.onopen=t=>{this._logger.log(m.Information,`WebSocket connected to ${e}.`),this._webSocket=s,c=!0,n()},s.onerror=e=>{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"There was an error with the transport",this._logger.log(m.Information,`(WebSockets transport) ${t}.`)},s.onmessage=e=>{if(this._logger.log(m.Trace,`(WebSockets transport) data received. ${y(e.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(e.data)}catch(e){return void this._close(e)}},s.onclose=e=>{if(c)this._close(e);else{let t=null;t="undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(t))}}}))}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(m.Trace,`(WebSockets transport) sending data. ${y(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(m.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(e)||!1!==e.wasClean&&1e3===e.code?e instanceof Error?this.onclose(e):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)))}_isCloseEvent(e){return e&&"boolean"==typeof e.wasClean&&"number"==typeof e.code}}class H{constructor(e,t={}){var n;if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,w.isRequired(e,"url"),this._logger=void 0===(n=t.logger)?new k(m.Information):null===n?v.instance:void 0!==n.log?n:new k(n),this.baseUrl=this._resolveUrl(e),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let i=null,r=null;_.isNode&&(i=o(449),r=o(194)),_.isNode||"undefined"==typeof WebSocket||t.WebSocket?_.isNode&&!t.WebSocket&&i&&(t.WebSocket=i):t.WebSocket=WebSocket,_.isNode||"undefined"==typeof EventSource||t.EventSource?_.isNode&&!t.EventSource&&void 0!==r&&(t.EventSource=r):t.EventSource=EventSource,this._httpClient=new a(t.httpClient||new x(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||B.Binary,w.isIn(e,B,"transferFormat"),this._logger.log(m.Debug,`Starting connection with transfer format '${B[e]}'.`),"Disconnected"!==this._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,"Disconnecting"===this._connectionState){const e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(m.Error,e),await this._stopPromise,Promise.reject(new l(e))}if("Connected"!==this._connectionState){const e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(m.Error,e),Promise.reject(new l(e))}this._connectionStarted=!0}send(e){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new z(this.transport)),this._sendQueue.send(e))}async stop(e){return"Disconnected"===this._connectionState?(this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===this._connectionState?(this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState="Disconnecting",this._stopPromise=new Promise((e=>{this._stopPromiseResolver=e})),await this._stopInternal(e),void await this._stopPromise)}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch(e){}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(m.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(m.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation){if(this._options.transport!==U.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this._constructTransport(U.WebSockets),await this._startTransport(t,e)}else{let o=null,n=0;do{if(o=await this._getNegotiationResponse(t),"Disconnecting"===this._connectionState||"Disconnected"===this._connectionState)throw new l("The connection was stopped during negotiation.");if(o.error)throw new Error(o.error);if(o.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(o.url&&(t=o.url),o.accessToken){const e=o.accessToken;this._accessTokenFactory=()=>e,this._httpClient._accessToken=e,this._httpClient._accessTokenFactory=void 0}n++}while(o.url&&n<100);if(100===n&&o.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,o,e)}this.transport instanceof N&&(this.features.inherentKeepAlive=!0),"Connecting"===this._connectionState&&(this._logger.log(m.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(e){return this._logger.log(m.Error,"Failed to start the connection: "+e),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(e)}}async _getNegotiationResponse(e){const t={},[o,n]=T();t[o]=n;const i=this._resolveNegotiateUrl(e);this._logger.log(m.Debug,`Sending negotiation request: ${i}.`);try{const e=await this._httpClient.post(i,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(200!==e.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${e.statusCode}'`));const o=JSON.parse(e.content);return(!o.negotiateVersion||o.negotiateVersion<1)&&(o.connectionToken=o.connectionId),o.useStatefulReconnect&&!0!==this._options._useStatefulReconnect?Promise.reject(new f("Client didn't negotiate Stateful Reconnect but the server did.")):o}catch(e){let t="Failed to complete negotiation with the server: "+e;return e instanceof c&&404===e.statusCode&&(t+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(m.Error,t),Promise.reject(new f(t))}}_createConnectUrl(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+`id=${t}`:e}async _createTransport(e,t,o,n){let i=this._createConnectUrl(e,o.connectionToken);if(this._isITransport(t))return this._logger.log(m.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(i,n),void(this.connectionId=o.connectionId);const r=[],s=o.availableTransports||[];let a=o;for(const o of s){const s=this._resolveTransportOrError(o,t,n,!0===(null==a?void 0:a.useStatefulReconnect));if(s instanceof Error)r.push(`${o.transport} failed:`),r.push(s);else if(this._isITransport(s)){if(this.transport=s,!a){try{a=await this._getNegotiationResponse(e)}catch(e){return Promise.reject(e)}i=this._createConnectUrl(e,a.connectionToken)}try{return await this._startTransport(i,n),void(this.connectionId=a.connectionId)}catch(e){if(this._logger.log(m.Error,`Failed to start the transport '${o.transport}': ${e}`),a=void 0,r.push(new g(`${o.transport} failed: ${e}`,U[o.transport])),"Connecting"!==this._connectionState){const e="Failed to select transport before stop() was called.";return this._logger.log(m.Debug,e),Promise.reject(new l(e))}}}}return r.length>0?Promise.reject(new p(`Unable to connect to the server with any of the available transports. ${r.join(" ")}`,r)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case U.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new W(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case U.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new q(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case U.LongPolling:return new N(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async o=>{let n=!1;if(this.features.reconnect){try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{n=!0}n&&this._stopConnection(o)}else this._stopConnection(o)}:this.transport.onclose=e=>this._stopConnection(e),this.transport.connect(e,t)}_resolveTransportOrError(e,t,o,n){const i=U[e.transport];if(null==i)return this._logger.log(m.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(!function(e,t){return!e||!!(t&e)}(t,i))return this._logger.log(m.Debug,`Skipping transport '${U[i]}' because it was disabled by the client.`),new u(`'${U[i]}' is disabled by the client.`,i);if(!(e.transferFormats.map((e=>B[e])).indexOf(o)>=0))return this._logger.log(m.Debug,`Skipping transport '${U[i]}' because it does not support the requested transfer format '${B[o]}'.`),new Error(`'${U[i]}' does not support ${B[o]}.`);if(i===U.WebSockets&&!this._options.WebSocket||i===U.ServerSentEvents&&!this._options.EventSource)return this._logger.log(m.Debug,`Skipping transport '${U[i]}' because it is not supported in your environment.'`),new h(`'${U[i]}' is not supported in your environment.`,i);this._logger.log(m.Debug,`Selecting transport '${U[i]}'.`);try{return this.features.reconnect=i===U.WebSockets?n:void 0,this._constructTransport(i)}catch(e){return e}}_isITransport(e){return e&&"object"==typeof e&&"connect"in e}_stopConnection(e){if(this._logger.log(m.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(m.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),e?this._logger.log(m.Error,`Connection disconnected with error '${e}'.`):this._logger.log(m.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch((e=>{this._logger.log(m.Error,`TransportSendQueue.stop() threw error '${e}'.`)})),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(m.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}else this._logger.log(m.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if(!_.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(m.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const o=new URLSearchParams(t.searchParams);return o.has("negotiateVersion")||o.append("negotiateVersion",this._negotiateVersion.toString()),o.has("useStatefulReconnect")?"true"===o.get("useStatefulReconnect")&&(this._options._useStatefulReconnect=!0):!0===this._options._useStatefulReconnect&&o.append("useStatefulReconnect","true"),t.search=o.toString(),t.toString()}}class z{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new G,this._transportResult=new G,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new G),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new G;const e=this._transportResult;this._transportResult=void 0;const t="string"==typeof this._buffer[0]?this._buffer.join(""):z._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(t){e.reject(t)}}}static _concatBuffers(e){const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),o=new Uint8Array(t);let n=0;for(const t of e)o.set(new Uint8Array(t),n),n+=t.byteLength;return o.buffer}}class G{constructor(){this.promise=new Promise(((e,t)=>[this._resolver,this._rejecter]=[e,t]))}resolve(){this._resolver()}reject(e){this._rejecter(e)}}class V{static write(e){return`${e}${V.RecordSeparator}`}static parse(e){if(e[e.length-1]!==V.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(V.RecordSeparator);return t.pop(),t}}V.RecordSeparatorCode=30,V.RecordSeparator=String.fromCharCode(V.RecordSeparatorCode);class K{writeHandshakeRequest(e){return V.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,o;if(S(e)){const n=new Uint8Array(e),i=n.indexOf(V.RecordSeparatorCode);if(-1===i)throw new Error("Message is incomplete.");const r=i+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(n.slice(0,r))),o=n.byteLength>r?n.slice(r).buffer:null}else{const n=e,i=n.indexOf(V.RecordSeparator);if(-1===i)throw new Error("Message is incomplete.");const r=i+1;t=n.substring(0,r),o=n.length>r?n.substring(r):null}const n=V.parse(t),i=JSON.parse(n[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[o,i]}}!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close",e[e.Ack=8]="Ack",e[e.Sequence=9]="Sequence"}(j||(j={}));class J{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new R(this,e)}}class X{constructor(e,t,o){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=o}async _send(e){const t=this._protocol.writeMessage(e);let o=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let e=()=>{},n=()=>{};S(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(o=new Promise(((t,o)=>{e=t,n=o}))),this._messages.push(new Q(t,this._totalMessageCount,e,n))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await o}_ack(e){let t=-1;for(let o=0;o<this._messages.length;o++){const n=this._messages[o];if(n._id<=e.sequenceId)t=o,S(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else{if(!(this._bufferedByteCount<this._bufferSize))break;n._resolver()}}-1!==t&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type===j.Sequence&&(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){e.sequenceId>this._nextReceivingSequenceId?this._connection.stop(new Error("Sequence ID greater than amount of messages we've received.")):this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=0!==this._messages.length?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:j.Sequence,sequenceId:e}));const t=this._messages;for(const e of t)await this._connection.send(e._message);this._reconnectInProgress=!1}_dispose(e){null!=e||(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case j.Invocation:case j.StreamItem:case j.Completion:case j.StreamInvocation:case j.CancelInvocation:return!0;case j.Close:case j.Sequence:case j.Ping:case j.Ack:return!1}}_ackTimer(){void 0===this._ackTimerHandle&&(this._ackTimerHandle=setTimeout((async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:j.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0}),1e3))}}class Q{constructor(e,t,o,n){this._message=e,this._id=t,this._resolver=o,this._rejector=n}}!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Connected="Connected",e.Disconnecting="Disconnecting",e.Reconnecting="Reconnecting"}(O||(O={}));class Y{static create(e,t,o,n,i,r,s){return new Y(e,t,o,n,i,r,s)}constructor(e,t,o,n,i,r,s){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(m.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},w.isRequired(e,"connection"),w.isRequired(t,"logger"),w.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=null!=i?i:3e4,this.keepAliveIntervalInMilliseconds=null!=r?r:15e3,this._statefulReconnectBufferSize=null!=s?s:1e5,this._logger=t,this._protocol=o,this.connection=e,this._reconnectPolicy=n,this._handshakeProtocol=new K,this.connection.onreceive=e=>this._processIncomingData(e),this.connection.onclose=e=>this._connectionClosed(e),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=O.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:j.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==O.Disconnected&&this._connectionState!==O.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==O.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=O.Connecting,this._logger.log(m.Debug,"Starting HubConnection.");try{await this._startInternal(),_.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=O.Connected,this._connectionStarted=!0,this._logger.log(m.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=O.Disconnected,this._logger.log(m.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise(((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t}));await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const o={protocol:this._protocol.name,version:t};if(this._logger.log(m.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(o)),this._logger.log(m.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;!!this.connection.features.reconnect&&(this._messageBuffer=new X(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(m.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch(e){}}_stopInternal(e){if(this._connectionState===O.Disconnected)return this._logger.log(m.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===O.Disconnecting)return this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=O.Disconnecting,this._logger.log(m.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(m.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===O.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new l("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[o,n]=this._replaceStreamingParams(t),i=this._createStreamInvocation(e,t,n);let r;const s=new J;return s.cancelCallback=()=>{const e=this._createCancelInvocation(i.invocationId);return delete this._callbacks[i.invocationId],r.then((()=>this._sendWithProtocol(e)))},this._callbacks[i.invocationId]=(e,t)=>{t?s.error(t):e&&(e.type===j.Completion?e.error?s.error(new Error(e.error)):s.complete():s.next(e.item))},r=this._sendWithProtocol(i).catch((e=>{s.error(e),delete this._callbacks[i.invocationId]})),this._launchStreams(o,r),s}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[o,n]=this._replaceStreamingParams(t),i=this._sendWithProtocol(this._createInvocation(e,t,!0,n));return this._launchStreams(o,i),i}invoke(e,...t){const[o,n]=this._replaceStreamingParams(t),i=this._createInvocation(e,t,!1,n);return new Promise(((e,t)=>{this._callbacks[i.invocationId]=(o,n)=>{n?t(n):o&&(o.type===j.Completion?o.error?t(new Error(o.error)):e(o.result):t(new Error(`Unexpected message type: ${o.type}`)))};const n=this._sendWithProtocol(i).catch((e=>{t(e),delete this._callbacks[i.invocationId]}));this._launchStreams(o,n)}))}on(e,t){e&&t&&(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),-1===this._methods[e].indexOf(t)&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const o=this._methods[e];if(o)if(t){const n=o.indexOf(t);-1!==n&&(o.splice(n,1),0===o.length&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const e of t)if(!this._messageBuffer||this._messageBuffer._shouldProcessMessage(e))switch(e.type){case j.Invocation:this._invokeClientMethod(e);break;case j.StreamItem:case j.Completion:{const t=this._callbacks[e.invocationId];if(t){e.type===j.Completion&&delete this._callbacks[e.invocationId];try{t(e)}catch(e){this._logger.log(m.Error,`Stream callback threw error: ${M(e)}`)}}break}case j.Ping:break;case j.Close:{this._logger.log(m.Information,"Close message received from server.");const t=e.error?new Error("Server returned an error on close: "+e.error):void 0;!0===e.allowReconnect?this.connection.stop(t):this._stopPromise=this._stopInternal(t);break}case j.Ack:this._messageBuffer&&this._messageBuffer._ack(e);break;case j.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(e);break;default:this._logger.log(m.Warning,`Invalid message type: ${e.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(e){const t="Error parsing handshake response: "+e;this._logger.log(m.Error,t);const o=new Error(t);throw this._handshakeRejecter(o),o}if(t.error){const e="Server returned handshake error: "+t.error;this._logger.log(m.Error,e);const o=new Error(e);throw this._handshakeRejecter(o),o}return this._logger.log(m.Debug,"Server handshake complete."),this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout((()=>this.serverTimeout()),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let e=this._nextKeepAlive-(new Date).getTime();e<0&&(e=0),this._pingServerHandle=setTimeout((async()=>{if(this._connectionState===O.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}),e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),o=this._methods[t];if(!o)return this._logger.log(m.Warning,`No client method with the name '${t}' found.`),void(e.invocationId&&(this._logger.log(m.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null))));const n=o.slice(),i=!!e.invocationId;let r,s,a;for(const o of n)try{const n=r;r=await o.apply(this,e.arguments),i&&r&&n&&(this._logger.log(m.Error,`Multiple results provided for '${t}'. Sending error to server.`),a=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),s=void 0}catch(e){s=e,this._logger.log(m.Error,`A callback for the method '${t}' threw error '${e}'.`)}a?await this._sendWithProtocol(a):i?(s?a=this._createCompletionMessage(e.invocationId,`${s}`,null):void 0!==r?a=this._createCompletionMessage(e.invocationId,null,r):(this._logger.log(m.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),a=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(a)):r&&this._logger.log(m.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(m.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new l("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===O.Disconnecting?this._completeClose(e):this._connectionState===O.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===O.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=O.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(null!=e?e:new Error("Connection closed.")),this._messageBuffer=void 0),_.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach((t=>t.apply(this,[e])))}catch(t){this._logger.log(m.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let o=0,n=void 0!==e?e:new Error("Attempting to reconnect due to a unknown error."),i=this._getNextRetryDelay(o++,0,n);if(null===i)return this._logger.log(m.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this._completeClose(e);if(this._connectionState=O.Reconnecting,e?this._logger.log(m.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(m.Information,"Connection reconnecting."),0!==this._reconnectingCallbacks.length){try{this._reconnectingCallbacks.forEach((t=>t.apply(this,[e])))}catch(t){this._logger.log(m.Error,`An onreconnecting callback called with error '${e}' threw error '${t}'.`)}if(this._connectionState!==O.Reconnecting)return void this._logger.log(m.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==i;){if(this._logger.log(m.Information,`Reconnect attempt number ${o} will start in ${i} ms.`),await new Promise((e=>{this._reconnectDelayHandle=setTimeout(e,i)})),this._reconnectDelayHandle=void 0,this._connectionState!==O.Reconnecting)return void this._logger.log(m.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this._startInternal(),this._connectionState=O.Connected,this._logger.log(m.Information,"HubConnection reconnected successfully."),0!==this._reconnectedCallbacks.length)try{this._reconnectedCallbacks.forEach((e=>e.apply(this,[this.connection.connectionId])))}catch(e){this._logger.log(m.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${e}'.`)}return}catch(e){if(this._logger.log(m.Information,`Reconnect attempt failed because of error '${e}'.`),this._connectionState!==O.Reconnecting)return this._logger.log(m.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this._connectionState===O.Disconnecting&&this._completeClose());n=e instanceof Error?e:new Error(e.toString()),i=this._getNextRetryDelay(o++,Date.now()-t,n)}}this._logger.log(m.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${o} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:o})}catch(o){return this._logger.log(m.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${o}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach((o=>{const n=t[o];try{n(null,e)}catch(t){this._logger.log(m.Error,`Stream 'error' callback called with '${e}' threw error: ${M(t)}`)}}))}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,o,n){if(o)return 0!==n.length?{arguments:t,streamIds:n,target:e,type:j.Invocation}:{arguments:t,target:e,type:j.Invocation};{const o=this._invocationId;return this._invocationId++,0!==n.length?{arguments:t,invocationId:o.toString(),streamIds:n,target:e,type:j.Invocation}:{arguments:t,invocationId:o.toString(),target:e,type:j.Invocation}}}_launchStreams(e,t){if(0!==e.length){t||(t=Promise.resolve());for(const o in e)e[o].subscribe({complete:()=>{t=t.then((()=>this._sendWithProtocol(this._createCompletionMessage(o))))},error:e=>{let n;n=e instanceof Error?e.message:e&&e.toString?e.toString():"Unknown error",t=t.then((()=>this._sendWithProtocol(this._createCompletionMessage(o,n))))},next:e=>{t=t.then((()=>this._sendWithProtocol(this._createStreamItemMessage(o,e))))}})}}_replaceStreamingParams(e){const t=[],o=[];for(let n=0;n<e.length;n++){const i=e[n];if(this._isObservable(i)){const r=this._invocationId;this._invocationId++,t[r]=i,o.push(r.toString()),e.splice(n,1)}}return[t,o]}_isObservable(e){return e&&e.subscribe&&"function"==typeof e.subscribe}_createStreamInvocation(e,t,o){const n=this._invocationId;return this._invocationId++,0!==o.length?{arguments:t,invocationId:n.toString(),streamIds:o,target:e,type:j.StreamInvocation}:{arguments:t,invocationId:n.toString(),target:e,type:j.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:j.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:j.StreamItem}}_createCompletionMessage(e,t,o){return t?{error:t,invocationId:e,type:j.Completion}:{invocationId:e,result:o,type:j.Completion}}_createCloseMessage(){return{type:j.Close}}}class Z{constructor(){this.name="json",this.version=2,this.transferFormat=B.Text}parseMessages(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=v.instance);const o=V.parse(e),n=[];for(const e of o){const o=JSON.parse(e);if("number"!=typeof o.type)throw new Error("Invalid payload.");switch(o.type){case j.Invocation:this._isInvocationMessage(o);break;case j.StreamItem:this._isStreamItemMessage(o);break;case j.Completion:this._isCompletionMessage(o);break;case j.Ping:case j.Close:break;case j.Ack:this._isAckMessage(o);break;case j.Sequence:this._isSequenceMessage(o);break;default:t.log(m.Information,"Unknown message type '"+o.type+"' ignored.");continue}n.push(o)}return n}writeMessage(e){return V.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if("number"!=typeof e.sequenceId)throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if("string"!=typeof e||""===e)throw new Error(t)}}const ee={trace:m.Trace,debug:m.Debug,info:m.Information,information:m.Information,warn:m.Warning,warning:m.Warning,error:m.Error,critical:m.Critical,none:m.None};class te{configureLogging(e){if(w.isRequired(e,"logging"),void 0!==e.log)this.logger=e;else if("string"==typeof e){const t=function(e){const t=ee[e.toLowerCase()];if(void 0!==t)return t;throw new Error(`Unknown log level: ${e}`)}(e);this.logger=new k(t)}else this.logger=new k(e);return this}withUrl(e,t){return w.isRequired(e,"url"),w.isNotEmpty(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return w.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new n(e):this.reconnectPolicy=e:this.reconnectPolicy=new n,this}withServerTimeout(e){return w.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return w.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return void 0===this.httpConnectionOptions&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=null==e?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new H(this.url,e);return Y.create(t,this.logger||v.instance,this.protocol||new Z,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}var oe,ne,ie=[],re=function(e){if(ne&&ne.invoke){var t=new FileReader;t.onload=function(){var e=t.result.split(",")[1];ne.invoke("SendVoiceSignal",e)},t.readAsDataURL(e)}},se=function(){console.log("SignalR connection started"),oe.startRecording(),console.log("RecordRTC recorder started")},ae=function(e){var t=function(e,t){for(var o=atob(e),n=[],i=0;i<o.length;i+=512){for(var r=o.slice(i,i+512),s=new Array(r.length),a=0;a<r.length;a++)s[a]=r.charCodeAt(a);var c=new Uint8Array(s);n.push(c)}return new Blob(n,{type:"audio/wav"})}(e);ie.push(t);var o=URL.createObjectURL(new Blob(ie,{type:"audio/wav"})),n=new Audio;n.src=o,n.play().then((function(){console.log("Audio playback started")})).catch((function(e){console.error("Error during audio playback:",e)}))};$((function(){return t=void 0,o=void 0,i=function(){var t,o;return function(e,t){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 1:return t=n.sent(),oe=new e(t,{type:"audio",mimeType:"audio/wav",timeSlice:250,ondataavailable:re}),(ne=(new te).withUrl("/chat/text").build()).on("ReceiveVoiceSignal",ae),ne.start().then(se).catch((function(e){console.error("SignalR connection error:",e)})),[3,3];case 2:return o=n.sent(),console.error("Error accessing media devices:",o),[3,3];case 3:return[2]}}))},new((n=void 0)||(n=Promise))((function(e,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(s,a)}c((i=i.apply(t,o||[])).next())}));var t,o,n,i}))})()})();